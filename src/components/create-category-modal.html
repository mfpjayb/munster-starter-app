<template>
    <div class="modal fade" id="add-category-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">New Category</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-6">
                            <label>Category</label>
                            <input value={this.state.category} on:input={this.setCategory} class="form-control"
                                type="text" placeholder="Enter category" />
                        </div>
                        <div class="col-6">
                            <label>Category key</label>
                            <input value={this.state.categoryKey} disabled="true" class="form-control" type="text"
                                placeholder="Enter category key" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button v:ref={this.$refs.cancelBtn} class="btn btn-secondary" type="button"
                        data-dismiss="modal">Cancel</button>
                    <button on:click={this.createCategory} class="btn btn-primary">Create</button>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
import CategoryService from "../services/category.service";

export default class CreateCategoryModal {

    $refs = {
        cancelBtn: null
    };
    categoryService = new CategoryService();
    state = {
        category: null,
        categoryKey: null
    };

    async createCategory() {
        const { category, categoryKey } = this.state;
        const response = await this.categoryService.create(category, categoryKey);
        this.$props.newCategoryCreated(response);
        this.$refs.cancelBtn.click();
    }

    setCategory(event) {
        this.state.category = event.target.value;
        this.state.categoryKey = event.target.value.replace(/\s/g, '_').toUpperCase();
    }
}
</script>