<template>
        <div class="container-fluid">
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">{this.category?.category}</h1>
            </div>

            <div class="card shadow mb-4">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>Filename</th>
                                    <th>Upload Date</th>
                                    <th>Page Number</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>Filename</th>
                                    <th>Upload Date</th>
                                    <th>Page Number</th>
                                    <th>Action</th>
                                </tr>
                            </tfoot>
                            <tbody>
                                <tr v:for={this.categorized} v:for-item="category">
                                    <td><plug-link href={`/auth/pdf-viewer/${category.filename}`}>{category.originalname}</plug-link></td>
                                    <td>{new Date(category.createdAt).toDateString()}</td>
                                    <td>{category.pageNumber}</td>
                                    <td class="py-2">
                                        <plug-link href={`/auth/pdf-viewer-page/${category.filename}/${category.pageNumber}`} class="btn btn-sm btn-primary">View</plug-link>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
</template>

<script>
import CategorizedTextService from "../services/categorized-text.service";
import CategoryService from "../services/category.service";

export default class Report {

    categoryService = new CategoryService();
    categorizedTextService = new CategorizedTextService();
    category;
    categorized = [];
    subscriptions = [];

    $connected() {
        this.onRouteChange();
        this.subscriptions.push(this.$router.onRouteChange.subscribe(() => {
            this.onRouteChange();
        }));
    }

    $disconnected() {
        this.subscriptions.forEach(item => item.unsubscribe());
    }

    async onRouteChange() {
        const response = await this.categoryService.show(this.$router.params().categoryKey);
        this.category = response;
        this.$apply();
        const response2 = await this.categorizedTextService.fetch(this.$router.params().categoryKey);
        this.categorized = response2;
        this.$apply();
    }
}
</script>